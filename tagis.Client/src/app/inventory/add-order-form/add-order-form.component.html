<div class="row col-xs-12">
  <h1>{{ pageTitle }}</h1></div>
<form [formGroup]="addOrderForm" novalidate (submit)="submitOrder(addOrderForm)">
  <div class="row">
    <div class="col-xs-12">
      <div class="component-body">
        <h3>Products</h3>
        <div formArrayName="products">
          <div *ngFor="let product of addOrderForm.controls.products.controls; let i = index">
            <div>
              <span>Product {{ i + 1 }}</span>
              <small class="pull-right" *ngIf="addOrderForm.controls.products.controls.length > 1" (click)="removeProduct(i)"><a>Remove product</a></small>
            </div>
            <div [formGroupName]="i" class="row">
              <div class="col-xs-12 col-sm-6" style="padding-left: 0;">
                <!-- SKU -->
                <div class="form-group">
                  <input required type="text" formControlName="sku" list="products" #sku_field [ngClass]="{'filled': sku_field.value != '' && sku_field.value != null}" (focusout)="checkSku($event.target.value, i, $event)" />
                  <label>SKU</label>
                  <div [hidden]="addOrderForm.controls.products.controls[i].controls.sku.valid" *ngIf="addOrderForm.controls.products.controls[i].controls.sku.touched" class="alert alert-danger" style="margin-top: 10px;">The entered SKU is invalid.</div>
                </div>
              </div>
              <div class="col-xs-12 col-sm-6" style="padding-right: 0;">
                <div class="form-group">
                  <input required type="number" formControlName="quantity" #quantity_field [ngClass]="{'filled': quantity_field.value != '' && quantity_field.value != null}" (focusout)="checkInput($event.target)" />
                  <label>Quantity</label>
                </div>
              </div>
            </div>
          </div>
        </div>
        <small style="margin-bottom: 30px; display:block;"><a (click)="addProducts()">Add product</a></small>
        <h3>Order total</h3>
        <div class="row">
          <div class="col-xs-12 col-sm-6" style="padding-left: 0;">
            <div class="form-group">
              <input type="text" name="subtotal" formControlName="subtotal" (focusout)="checkInput($event.target)" [(ngModel)]="order.subtotal" [ngClass]="{'filled': order.subtotal}" #subtotal />
              <label for="subtotal">Order subtotal</label>
            </div>
          </div>
          <div class="col-xs-12 col-sm-6" style="padding-right: 0;">
            <div class="form-group">
              <input type="text" name="total" formControlName="total" (focusout)="checkInput($event.target)" [(ngModel)]="order.total" [ngClass]="{'filled': order.total}" #total />
              <label for="total">Order total</label>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12 col-sm-6">
      <div class="component-body">
        <h3>Customer information</h3>
        <div class="form-group">
          <input type="text" name="customer_name" required formControlName="customer_name" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerName" [ngClass]="{'filled': order.customerName}" #customerName />
          <label (click)="customerName.focus()">Customer name</label>
        </div>
        <div class="form-group">
          <input type="email" name="customer_email" required formControlName="customer_email" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerEmail" [ngClass]="{'filled': order.customerEmail}" #customerEmail />
          <label (click)="customerEmail.focus()">Customer email</label>
        </div>
        <div class="form-group">
          <input type="text" name="customer_phone" formControlName="customer_phone" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerPhone" [ngClass]="{'filled': order.customerPhone}" #customerPhone />
          <label (click)="customerPhone.focus()">Customer phone</label>
        </div>
        <div class="form-group">
          <input type="text" name="customer_address1" required formControlName="customer_address1" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerAddress1" [ngClass]="{'filled': order.customerAddress1}" #address1 />
          <label (click)="address1.focus()">Street address</label>
        </div>
        <div class="form-group">
          <input type="text" name="customer_address2" formControlName="customer_address2" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerAddress2" [ngClass]="{'filled': order.customerAddress2}" #address2 />
          <label (click)="address2.focus()">Street address 2</label>
        </div>
        <div class="form-group">
          <input type="text" name="customer_city" required formControlName="customer_city" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerCity" [ngClass]="{'filled': order.customerCity}" #city />
          <label (click)="city.focus()">City</label>
        </div>
        <div class="row" style="margin: 0;">
          <div class="col-xs-6" style="padding-left: 0;">
            <div class="form-group">
              <select name="customer_state" formControlName="customer_state" class="col-xs-12" [(ngModel)]="order.customerState" required>
                <option value="" disabled selected="selected">State *</option>
                <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <option value="AR">Arkansas</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DE">Delaware</option>
                <option value="DC">District Of Columbia</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="IA">Iowa</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="ME">Maine</option>
                <option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MS">Mississippi</option>
                <option value="MO">Missouri</option>
                <option value="MT">Montana</option>
                <option value="NE">Nebraska</option>
                <option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NY">New York</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VT">Vermont</option>
                <option value="VA">Virginia</option>
                <option value="WA">Washington</option>
                <option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option>
                <option value="WY">Wyoming</option>
              </select>
            </div>
          </div>
          <div class="col-xs-6" style="padding-right: 0;">
            <div class="form-group">
              <input type="text" name="customer_zip" required formControlName="customer_zip" (focusout)="checkInput($event.target)" [(ngModel)]="order.customerZip" [ngClass]="{'filled': order.customerZip}" #zip/>
              <label (click)="zip.focus()">Zip</label>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="col-xs-12 col-sm-6">
      <div class="component-body">
        <h3>Store information</h3>
        <div class="form-group">
          <store-selector [saved-store]="order.store" (store-selected)="addCompany($event)"></store-selector>
        </div>
        <div class="form-group">
          <input type="text" class="filled" placeholder="https://store.adventstores.com" name="order_source" class="filled" formControlName="order_source" [(ngModel)]="order.orderSource" #orderSource />
          <label (click)="orderSource.focus()">Order source</label>
        </div>
        <div class="form-group">
          <input type="text" name="ref" formControlName="ref" (focusout)="checkInput($event.target)" [(ngModel)]="order.ref" [ngClass]="{'filled': order.ref}" #ref />
          <label (click)="ref.focus()">Reference number</label>
        </div>
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-xs-12">
      <div class="component-body">
        <h3>Shipping information</h3>
        <div class="row">
          <div class="col-xs-12 col-sm-6">
            <div class="form-group">
              <input type="text" name="shipping_name" formControlName="shipping_name" (focusout)="checkInput($event.target)" [(ngModel)]="order.shippingName" [ngClass]="{'filled': order.shippingName}" #shippingName />
              <label (click)="shippingName.focus()">Ship to</label>
            </div>
            <div class="form-group">
              <input type="text" name="shipping_address1" formControlName="shipping_address1" (focusout)="checkInput($event.target)" [(ngModel)]="order.shippingAddress1" [ngClass]="{'filled': order.shippingAddress1}" #shippingAddress1 />
              <label (click)="shippingAddress1.focus()">Street address</label>
            </div>
            <div class="form-group">
              <input type="text" name="shipping_address2" formControlName="shipping_address2" (focusout)="checkInput($event.target)" [(ngModel)]="order.shippingAddress2" [ngClass]="{'filled': order.shippingAddress2}" #shippingAddress2 />
              <label (click)="shippingAddress2.focus()">Street address 2</label>
            </div>
            <div class="form-group">
              <input type="text" name="shipping_city" formControlName="shipping_city" (focusout)="checkInput($event.target)" [(ngModel)]="order.shippingCity" [ngClass]="{'filled': order.shippingCity}" #shippingCity />
              <label (click)="shippingCity.focus()">City</label>
            </div>
            <div class="form-group clearfix">
              <select name="shipping_state" formControlName="shipping_state" class="col-xs-12" [(ngModel)]="order.shippingState">
                <option value="state" disabled selected="selected">State *</option>
                <option value="AL">Alabama</option>
                <option value="AK">Alaska</option>
                <option value="AZ">Arizona</option>
                <option value="AR">Arkansas</option>
                <option value="CA">California</option>
                <option value="CO">Colorado</option>
                <option value="CT">Connecticut</option>
                <option value="DE">Delaware</option>
                <option value="DC">District Of Columbia</option>
                <option value="FL">Florida</option>
                <option value="GA">Georgia</option>
                <option value="HI">Hawaii</option>
                <option value="ID">Idaho</option>
                <option value="IL">Illinois</option>
                <option value="IN">Indiana</option>
                <option value="IA">Iowa</option>
                <option value="KS">Kansas</option>
                <option value="KY">Kentucky</option>
                <option value="LA">Louisiana</option>
                <option value="ME">Maine</option>
                <option value="MD">Maryland</option>
                <option value="MA">Massachusetts</option>
                <option value="MI">Michigan</option>
                <option value="MN">Minnesota</option>
                <option value="MS">Mississippi</option>
                <option value="MO">Missouri</option>
                <option value="MT">Montana</option>
                <option value="NE">Nebraska</option>
                <option value="NV">Nevada</option>
                <option value="NH">New Hampshire</option>
                <option value="NJ">New Jersey</option>
                <option value="NM">New Mexico</option>
                <option value="NY">New York</option>
                <option value="NC">North Carolina</option>
                <option value="ND">North Dakota</option>
                <option value="OH">Ohio</option>
                <option value="OK">Oklahoma</option>
                <option value="OR">Oregon</option>
                <option value="PA">Pennsylvania</option>
                <option value="RI">Rhode Island</option>
                <option value="SC">South Carolina</option>
                <option value="SD">South Dakota</option>
                <option value="TN">Tennessee</option>
                <option value="TX">Texas</option>
                <option value="UT">Utah</option>
                <option value="VT">Vermont</option>
                <option value="VA">Virginia</option>
                <option value="WA">Washington</option>
                <option value="WV">West Virginia</option>
                <option value="WI">Wisconsin</option>
                <option value="WY">Wyoming</option>
              </select>
            </div>
            <div class="form-group">
              <input type="text" name="shipping_zip" formControlName="shipping_zip" (focusout)="checkInput($event.target)" [(ngModel)]="order.shippingZip" [ngClass]="{'filled': order.shippingZip}" #zip/>
              <label (click)="zip.focus()">Zip</label>
            </div>
          </div>
          <div class="col-xs-12 col-sm-6">
            <div class="form-group">
              <input type="text" name="shippping_number" formControlName="shipping_number" (focusout)="checkInput($event.target)" [(ngModel)]="order.shippingNumber" [ngClass]="{'filled': order.shippingNumber}" #shipping_number>
              <label (click)="shipping_number.focus()">Shipping number</label>
            </div>
            <div class="form-group">
              <select name="shipping_carrier" formControlName="shipping_carrier" [(ngModel)]="order.shippingCarrier" [ngClass]="{'filled': order.shippingCarrier}" #shipping_carrier>
                <option value="carrier" selected="selected" disabled>Shipping carrier</option>
                <option value="UPS">UPS</option>
                <option value="USPS">USPS</option>
                <option value="FedEx">FedEx</option>
              </select>
            </div>
          </div>
          </div>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-xs-6">
        <div *ngIf="!orderId && !order.orderStatus">
          <input 
            type="checkbox" 
            name="send_order_receipt" 
            formControlName="send_order_receipt" 
            (click)="sendOrderReceipt()" 
            #send_order_receipt />
          <label for="send_emails" (click)="send_order_receipt.click()">Send order receipt</label>
        </div>
        <div *ngIf="order.receiptEmailSent">
          <small>Receipt email sent: {{ order.receiptEmailSent }}</small>
        </div>
        <div *ngIf="order.orderStatus != 'shipped' && order.orderStatus != 'completed' && shipping_number.value && shipping_carrier.value">
          <input 
            type="checkbox" 
            name="send_shipping_notification" 
            formControlName="send_shipping_notification" 
            (click)="sendShippingInfo()" 
            #send_shipping_notification/>
          <label for="send_emails" (click)="send_shipping_notification.click()">Send shipping notification</label>
        </div>
        <div *ngIf="order.orderStatus == 'shipped' && order.shipping_email_sent">
          <small>Shipping email sent: {{ order.shipping_email_sent }}</small>
        </div>
      </div>
      <div class="col-xs-6">
        <div class="form-controls">
          <a routerLink="/orders" class="form-cancel">Cancel</a>
          <input type="submit" class="btn btn-success" [disabled]="!addOrderForm.valid" value="Save order" />
        </div>
      </div>
    </div>
</form>
<datalist id="products">
  <option *ngFor="let product of productList" [value]="product.sku">{{ product._pid }}</option>
</datalist>
